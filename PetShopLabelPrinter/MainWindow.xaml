<Window x:Class="PetShopLabelPrinter.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Pet Shop Label Printer" Height="760" Width="1320"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Menu Grid.Row="0" Margin="0,0,0,4">
            <MenuItem Header="Súbor">
                <MenuItem Header="Import z Alfa+ (CSV)" Click="MenuImportAlfa_Click"/>
                <MenuItem Header="Export do CSV" Click="MenuExportCsv_Click"/>
            </MenuItem>
        </Menu>

        <DockPanel Grid.Row="1" Margin="8">
            <StackPanel Orientation="Horizontal">
                <Button x:Name="BtnUserMode" Content="Používateľ" Click="BtnUserMode_Click" Padding="12,6" Margin="0,0,6,0"/>
                <Button x:Name="BtnAdminMode" Content="Admin" Click="BtnAdminMode_Click" Padding="12,6" Margin="0,0,12,0"/>
                <TextBlock x:Name="TxtMode" VerticalAlignment="Center" FontWeight="Bold"/>
            </StackPanel>
            <TextBox x:Name="TxtSearch" DockPanel.Dock="Right" Width="260" Padding="6,4" TextChanged="TxtSearch_TextChanged"
                     ToolTip="Filtrovať podľa názvu/varianty"/>
        </DockPanel>

        <Grid x:Name="UserPanel" Grid.Row="2" Margin="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="300"/>
            </Grid.ColumnDefinitions>

            <DataGrid x:Name="ProductGrid"
                      Grid.Column="0"
                      AutoGenerateColumns="False"
                      CanUserAddRows="True"
                      CanUserDeleteRows="False"
                      SelectionMode="Extended"
                      SelectionUnit="FullRow"
                      RowEditEnding="ProductGrid_RowEditEnding"
                      SelectionChanged="ProductGrid_SelectionChanged"
                      MouseDoubleClick="ProductGrid_MouseDoubleClick">
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Upraviť" Click="ProductGrid_EditClick"/>
                        <MenuItem Header="Nastaviť šablónu..." Click="ProductGrid_SetTemplateClick"/>
                    </ContextMenu>
                </DataGrid.ContextMenu>
                <DataGrid.Columns>
                    <DataGridCheckBoxColumn Header="Tlačiť?" Binding="{Binding IsActiveForPrint, UpdateSourceTrigger=PropertyChanged}" Width="62"/>
                    <DataGridTextColumn Header="Produkt" Binding="{Binding ProductName, UpdateSourceTrigger=LostFocus}" Width="180"/>
                    <DataGridTextColumn Header="Šablóna" Binding="{Binding TemplateName}" Width="120" IsReadOnly="True"/>
                    <DataGridTemplateColumn Header="Varianta" Width="140">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding VariantText}" TextWrapping="Wrap"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                        <DataGridTemplateColumn.CellEditingTemplate>
                            <DataTemplate>
                                <TextBox Text="{Binding VariantText, UpdateSourceTrigger=LostFocus}" BorderThickness="0" Background="Transparent"
                                         TextWrapping="Wrap" AcceptsReturn="True" MinLines="1" MaxLines="3" VerticalScrollBarVisibility="Auto"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellEditingTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Bal. malé text" Binding="{Binding SmallPackLabel, UpdateSourceTrigger=LostFocus}" Width="130"/>
                    <DataGridTextColumn Header="Malé balenie cena" Binding="{Binding SmallPackPrice, UpdateSourceTrigger=LostFocus}" Width="95"/>
                    <DataGridTextColumn Header="Bal. veľké text" Binding="{Binding LargePackLabel, UpdateSourceTrigger=LostFocus}" Width="130"/>
                    <DataGridTextColumn Header="Veľké balenie cena" Binding="{Binding LargePackPrice, UpdateSourceTrigger=LostFocus}" Width="95"/>
                    <DataGridTextColumn Header="Jednotková cena text" Binding="{Binding UnitPriceText, UpdateSourceTrigger=LostFocus}" Width="160"/>
                    <DataGridTextColumn Header="Počet" Binding="{Binding Quantity, UpdateSourceTrigger=LostFocus}" Width="58"/>
                </DataGrid.Columns>
            </DataGrid>

            <StackPanel Grid.Column="1" Margin="12,0,0,0">
                <TextBlock Text="Šablóna štítku" Margin="0,0,0,4"/>
                <Grid Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <ComboBox x:Name="CmbLabelTemplate" Grid.Column="0" DisplayMemberPath="Name" SelectionChanged="CmbLabelTemplate_SelectionChanged"/>
                    <Button x:Name="BtnManageTemplates" Grid.Column="1" Content="..." Width="32" Margin="6,0,0,0" Padding="4,2" Click="BtnManageTemplates_Click" ToolTip="Spravovať šablóny"/>
                </Grid>
                <GroupBox Header="Alfa+ Sync" Padding="8" Margin="0,0,0,6">
                    <StackPanel>
                        <WrapPanel>
                            <Button x:Name="BtnAlfaImport" Content="Import z Alfa+ (CSV)" Click="MenuImportAlfa_Click" Padding="8,4" Margin="0,0,6,0"/>
                            <Button x:Name="BtnAlfaExport" Content="Export do CSV" Click="MenuExportCsv_Click" Padding="8,4"/>
                        </WrapPanel>
                        <TextBlock x:Name="TxtLastAlfaImport" Margin="0,6,0,0" Foreground="Gray"/>
                    </StackPanel>
                </GroupBox>
                <Button x:Name="BtnA4Settings" Content="A4 nastavenia" Click="BtnA4Settings_Click" Padding="12,8" Margin="0,0,0,6"/>
                <Button x:Name="BtnEditSelected" Content="Upraviť" Click="BtnEditSelected_Click" Padding="12,8" Margin="0,0,0,6" IsEnabled="False" ToolTip="Otvoriť dialóg úpravy vybraného riadku (alebo dvojklik)"/>
                <Button x:Name="BtnPrintSelected" Content="Tlačiť A4 (vybrané)" Click="BtnPrintSelected_Click" Padding="12,8" Margin="0,0,0,6"/>
                <Button x:Name="BtnExportSelected" Content="Export PDF (vybrané)" Click="BtnExportSelected_Click" Padding="12,8" Margin="0,0,0,6"/>
                <Button x:Name="BtnCalibrationTestPrint" Content="Test print (kalibrácia)" Click="BtnCalibrationTestPrint_Click" Padding="12,8" Margin="0,0,0,6"/>
                <Button x:Name="BtnClearSelection" Content="Vyčistiť výber/frontu" Click="BtnClearSelection_Click" Padding="12,8" Margin="0,0,0,6"/>
                <Button x:Name="BtnDeleteSelectedProducts" Content="Zmazať vybrané riadky" Click="BtnDeleteSelectedProducts_Click" Padding="12,8" Margin="0,0,0,12"/>

                <TextBlock Text="História úloh" FontWeight="Bold" Margin="0,0,0,6"/>
                <ListBox x:Name="HistoryList" SelectionChanged="HistoryList_SelectionChanged" Height="300">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="0,0,0,6">
                                <TextBlock Text="{Binding ProductNames}" FontWeight="SemiBold" TextWrapping="Wrap"/>
                                <TextBlock FontSize="11" Foreground="Gray"
                                           Text="{Binding PrintedAt, StringFormat='{}{0:g}'}"/>
                                <TextBlock FontSize="11" Foreground="Gray"
                                           Text="{Binding JobType, StringFormat='Typ: {0}'}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
                <Button x:Name="BtnOpenPdf" Content="Otvoriť PDF z histórie" Click="BtnOpenPdf_Click" Padding="12,8"
                        ToolTip="Dostupné iba pre exportované PDF položky."/>
            </StackPanel>
        </Grid>

        <ScrollViewer x:Name="AdminPanel" Grid.Row="2" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="16">
                <GroupBox Header="Písmo" Padding="12" Margin="0,0,0,8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Produkt (font / veľkosť / min)"/>
                            <StackPanel Orientation="Horizontal">
                                <ComboBox x:Name="CmbProductNameFont" Width="180" Margin="0,2" SelectionChanged="AdminSetting_Changed"/>
                                <TextBox x:Name="TxtProductNameSize" Width="48" Margin="6,2" TextChanged="AdminSetting_Changed"/>
                                <TextBox x:Name="TxtProductNameMinSize" Width="48" Margin="6,2" TextChanged="AdminSetting_Changed"/>
                                <CheckBox x:Name="ChkProductNameBold" Content="Bold" VerticalAlignment="Center" Margin="6,0"
                                          Checked="AdminSetting_Checked" Unchecked="AdminSetting_Checked"/>
                            </StackPanel>

                            <TextBlock Text="Varianta (font / veľkosť)" Margin="0,8,0,0"/>
                            <StackPanel Orientation="Horizontal">
                                <ComboBox x:Name="CmbVariantFont" Width="180" Margin="0,2" SelectionChanged="AdminSetting_Changed"/>
                                <TextBox x:Name="TxtVariantSize" Width="48" Margin="6,2" TextChanged="AdminSetting_Changed"/>
                                <CheckBox x:Name="ChkVariantBold" Content="Bold" VerticalAlignment="Center" Margin="6,0"
                                          Checked="AdminSetting_Checked" Unchecked="AdminSetting_Checked"/>
                            </StackPanel>
                        </StackPanel>
                        <StackPanel Grid.Column="1">
                            <TextBlock Text="Veľká cena (font / veľkosť)" />
                            <StackPanel Orientation="Horizontal">
                                <ComboBox x:Name="CmbPriceBigFont" Width="180" Margin="0,2" SelectionChanged="AdminSetting_Changed"/>
                                <TextBox x:Name="TxtPriceBigSize" Width="48" Margin="6,2" TextChanged="AdminSetting_Changed"/>
                                <CheckBox x:Name="ChkPriceBigBold" Content="Bold" VerticalAlignment="Center" Margin="6,0"
                                          Checked="AdminSetting_Checked" Unchecked="AdminSetting_Checked"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <GroupBox Header="Rozloženie a kalibrácia (mm)" Padding="12" Margin="0,0,0,8">
                    <StackPanel>
                        <WrapPanel>
                            <TextBlock Text="Šírka štítku" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtLabelWidthMm" Width="56" Margin="6,0,16,0" TextChanged="AdminSetting_Changed"/>
                            <TextBlock Text="Výška štítku" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtLabelHeightMm" Width="56" Margin="6,0,16,0" TextChanged="AdminSetting_Changed"/>
                            <TextBlock Text="Pravý stĺpec" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtRightColumnWidthMm" Width="56" Margin="6,0,16,0" TextChanged="AdminSetting_Changed"/>
                            <TextBlock Text="Hrúbka okraja" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtBorderThicknessMm" Width="56" Margin="6,0,16,0" TextChanged="AdminSetting_Changed"/>
                        </WrapPanel>
                        <WrapPanel Margin="0,8,0,0">
                            <TextBlock Text="Gap medzi štítkami" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtGapMm" Width="56" Margin="6,0,16,0" TextChanged="AdminSetting_Changed"/>
                            <TextBlock Text="Okraj stránky" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtPageMarginMm" Width="56" Margin="6,0,16,0" TextChanged="AdminSetting_Changed"/>
                            <TextBlock Text="Top/Mid/Bot" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtTopMm" Width="52" Margin="6,0,0,0" TextChanged="AdminSetting_Changed"/>
                            <TextBox x:Name="TxtMidMm" Width="52" Margin="6,0,0,0" TextChanged="AdminSetting_Changed"/>
                            <TextBox x:Name="TxtBotMm" Width="52" Margin="6,0,16,0" TextChanged="AdminSetting_Changed"/>
                        </WrapPanel>
                        <WrapPanel Margin="0,8,0,0">
                            <CheckBox x:Name="ChkShowSeparatorBetweenPacks" Content="Deliť malé/veľké balenie"
                                      VerticalAlignment="Center" Margin="0,0,16,0"
                                      Checked="AdminSetting_Checked" Unchecked="AdminSetting_Checked"/>
                            <CheckBox x:Name="ChkShowBottomSeparator" Content="Deliť veľké balenie/jednotková cena"
                                      VerticalAlignment="Center" Margin="0,0,16,0"
                                      Checked="AdminSetting_Checked" Unchecked="AdminSetting_Checked"/>
                            <CheckBox x:Name="ChkCropMarks" Content="Crop marks" VerticalAlignment="Center"
                                      Checked="AdminSetting_Checked" Unchecked="AdminSetting_Checked"/>
                        </WrapPanel>
                        <WrapPanel Margin="0,10,0,0">
                            <TextBlock Text="Offset X" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtOffsetX" Width="56" Margin="6,0,16,0" TextChanged="AdminSetting_Changed"/>
                            <TextBlock Text="Offset Y" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtOffsetY" Width="56" Margin="6,0,16,0" TextChanged="AdminSetting_Changed"/>
                            <Button x:Name="BtnSaveSettings" Content="Uložiť nastavenia" Click="BtnSaveSettings_Click" Padding="12,6"/>
                        </WrapPanel>
                        <TextBlock Margin="0,8,0,0" Foreground="Gray"
                                   Text="Offset posunie celú mriežku štítkov pre kompenzáciu driftu tlačiarne."/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Tlačiareň" Padding="12" Margin="0,0,0,8">
                    <StackPanel Orientation="Horizontal">
                        <ComboBox x:Name="CmbPrinter" Width="280" Margin="0,0,8,0"/>
                        <Button x:Name="BtnSavePrinter" Content="Uložiť tlačiareň" Click="BtnSavePrinter_Click" Padding="12,6"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Test kalibrácie" Padding="12" Margin="0,0,0,8">
                    <StackPanel Orientation="Horizontal">
                        <Button x:Name="BtnGenerateTestPdf" Content="Generovať PDF test" Click="BtnGenerateTestPdf_Click" Padding="12,6" Margin="0,0,8,0"/>
                        <Button x:Name="BtnPrintTest" Content="Tlačiť test" Click="BtnPrintTest_Click" Padding="12,6"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="História" Padding="12" Margin="0,0,0,8">
                    <Button x:Name="BtnClearHistory" Content="Vymazať históriu" Click="BtnClearHistory_Click" Padding="12,6"/>
                </GroupBox>

                <GroupBox Header="Živý náhľad (aktuálne vybraný riadok)" Padding="8">
                    <Border x:Name="PreviewBorder" BorderBrush="Gray" BorderThickness="1" Padding="8">
                        <Viewbox Stretch="Uniform">
                            <Canvas x:Name="PreviewCanvas" Width="300" Height="76" Background="White"/>
                        </Viewbox>
                    </Border>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
